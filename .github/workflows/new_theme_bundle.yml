name: New theme bundle

on:
  repository_dispatch:
    types: [new_theme_bundle]
  workflow_dispatch:
    inputs:
      release:
        description: 'release'
        type: string
        required: false
      bundle_file:
        description: 'bundle_file'
        type: string
        required: false
      bundle_url:
        description: 'bundle_url'
        type: string
        required: true

jobs:
  build:
    runs-on: ubuntu-20.04
    steps:  
      - name: Checkout
        uses: actions/checkout@v2       
      - name: Setup Perl environment
        uses: shogo82148/actions-setup-perl@v1.15.3
      - name: echo event
        run: |
          echo "${{ github.event.client_payload.release }}"
          echo "${{ github.event.client_payload.file }}"
          echo "${{ github.event.client_payload.url }}"
        env:
          release_name: ${{ github.event.inputs.release }}
          bundle_file: ${{ github.event.inputs.file }}
          bundle_url: ${{ github.event.inputs.url }}
          
      - name: Update theme bundle in Antora playbook
        run: |
          perl -007 -i -pe 's?.*ui:.*\n.*bundle:.*\n.*url:.*?ui:\n  bundle:\n    url: '$bundle_url'?' antora-playbook.yml
          
      - name: Commit/push Antora playbook
        uses: test-room-7/action-update-file@v1
        with:
          file-path: antora-playbook.yml
          commit-msg: Update Antora playbook with bundle $bundle_file
          github-token: ${{ secrets.GITHUB_TOKEN }}
